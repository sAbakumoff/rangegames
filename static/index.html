<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Game of ranges</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" 
integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
<style>
table.range{
    cursor : pointer;
}
table.range td{
    text-align:  center;
}
</style>
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
</head>

<body>
    <div id="container" class="container">
        <div class="row mt-2">
            <div class="col">
                <h1 id="hand"></h1>
            </div>
            <div class="col">
                <button id="btnHand" class="btn btn-primary">Next hand</button>
            </div>
            <div class="col">
                <button id="btnRange" class="btn btn-secondary">Next range</button>
            </div>

        </div>
        <div class="row mt-2">
            <div class="col" id="tableContainer">
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var currentRange = null;
        var currentHand = null;
        
        function gen_hand(){
            $.get('/hand', function success(hand){
                currentHand = hand;
                $('#hand').html(currentHand);
            })
        }
        function gen_range(){
            $.get('/range', function succeess(range){
                range = JSON.parse(range)
                currentRange = $(range.rgHtml);
                $('#tableContainer').html(range.rgHtml);
                $('table.range').addClass('table table-bordered table-dark');
                $('table.range td:empty').html("&Oslash;").addClass("text-dark")
            });            
        }
        
        $(function(){
            gen_hand();
            gen_range();
            $('#btnHand').on('click', gen_hand);
            $('#btnRange').on('click', gen_range);
            $('#tableContainer').on('click', 'table.range td:not(:empty)', function(ev){ 
                var col = $(this).closest("td").index();
                var row = $(this).closest("tr").index();
                var checkit = currentRange.find('tr').eq(row).find('td').eq(col).html();
                var td = $(this);
                if(checkit && checkit.length > 1){
                    $.post('/hand-vs-hand', {
                        h1 : currentHand,
                        h2 : checkit
                    }, 'json' ).done(function(data){
                        data = JSON.parse(data)
                        if(data[0] < data[1])
                            td.addClass('bg-danger')
                        else
                            td.addClass('bg-success')
                    });
                }
            });
        });
    </script>
</body>

</html>